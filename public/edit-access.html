<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaHub Editor Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --purple-dark: #0f001f;
            --purple-bg: #1e0037;
            --purple-medium: #3a006b;
            --purple-accent: #A55EEA;
            --purple-glow: #a55eea70;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: radial-gradient(circle at top left, var(--purple-dark) 0%, #000000 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .card {
            background: var(--purple-bg);
            border: 1px solid rgba(165, 94, 234, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 40px var(--purple-glow);
        }
        .btn-primary {
            background: linear-gradient(90deg, var(--purple-accent) 0%, var(--purple-medium) 100%);
            border: 1px solid var(--purple-accent);
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 0.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--purple-glow);
        }
        input[type="password"] {
            background: #2b004d;
            border: 1px solid var(--purple-accent);
            color: #fff;
        }
        input[type="password"]:focus {
            border-color: #fff;
            box-shadow: 0 0 10px var(--purple-glow);
            outline: none;
        }
        .status-message {
            padding: 0.5rem;
            border-radius: 0.375rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        .status-message.error {
            background-color: #4d0000;
            color: #ff5e5e;
            border: 1px solid #ff5e5e;
        }
        .status-message.success {
            background-color: #004d00;
            color: #5eff5e;
            border: 1px solid #5eff5e;
        }
    </style>
</head>
<body>
    <div class="card p-8 rounded-xl shadow-lg w-full max-w-sm">
        <h1 class="text-3xl font-bold text-center mb-6 text-white" style="text-shadow: 0 0 8px var(--purple-accent);">
            <span class="text-purple-accent">NovaHub</span> Editor
        </h1>
        
        <p class="text-sm text-gray-300 text-center mb-6">
            Enter the **Edit Password** to manage the script.
        </p>

        <div id="status-message" class="hidden"></div>
        
        <form id="edit-form" onsubmit="submitPassword(event)">
            <div class="mb-6">
                <input type="password" id="edit-password" name="password" 
                       class="w-full p-3 rounded-lg text-lg placeholder-gray-500" 
                       placeholder="Edit Password" required>
            </div>
            <button type="submit" id="submit-button" class="btn-primary w-full text-white">
                Access Editor
            </button>
        </form>
    </div>

    <script>
        const API_BASE_URL = window.location.origin;

        function getScriptKey() {
            const parts = window.location.pathname.split('/');
            
            return parts.pop() || parts.pop();
        }

        async function submitPassword(event) {
            event.preventDefault();
            
            const passwordInput = document.getElementById('edit-password');
            const submitButton = document.getElementById('submit-button');
            const statusDiv = document.getElementById('status-message');
            const scriptKey = getScriptKey();

            const password = passwordInput.value;

            if (!password.trim()) {
                statusDiv.className = 'status-message error';
                statusDiv.textContent = 'Please enter a password.';
                statusDiv.classList.remove('hidden');
                return;
            }

            submitButton.disabled = true;
            statusDiv.className = 'status-message';
            statusDiv.textContent = 'Verifying credentials...';
            statusDiv.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/get-raw-for-edit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key: scriptKey, password: password })
                });

                const data = await response.json();

                if (response.ok && data.rawScript) {
                    statusDiv.className = 'status-message success';
                    statusDiv.textContent = 'Access granted! Redirecting to Editor...';
                    
                    
                    window.location.href = `${API_BASE_URL}/editor.html?key=${scriptKey}&password=${password}`;

                } else {
                    statusDiv.className = 'status-message error';
                    statusDiv.textContent = data.error || 'Invalid Edit Password or Key.';
                }
            } catch (error) {
                statusDiv.className = 'status-message error';
                statusDiv.textContent = 'Error connecting to the server.';
                console.error('Frontend Error:', error);
            } finally {
                submitButton.disabled = false;
            }
        }

        
        document.addEventListener('DOMContentLoaded', () => {
             const passwordInput = document.getElementById('edit-password');
             passwordInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    submitPassword(event);
                }
            });
        });
    </script>
</body>
</html>
